# 宁夏文旅小程序 - Go 后端项目

## 项目完成情况

### ✅ 已完成

1. **项目结构搭建**
   - 标准的 Go 项目目录结构
   - API 控制器分层
   - 中间件（认证、跨域）
   - 工具函数（JWT、响应）
   - 数据模型定义

2. **数据库设计**
   - 用户表
   - 景点表
   - 美食表
   - 文化/非遗表
   - 商品表
   - 订单表
   - 订单明细表
   - 购物车表
   - 优惠券表
   - 管理员表

3. **核心功能**
   - ✅ JWT 认证（小程序 + 管理员）
   - ✅ RESTful API 设计
   - ✅ 分页查询
   - ✅ 文件上传
   - ✅ 用户登录/注册
   - ✅ 景点 CRUD
   - ✅ 美食 CRUD
   - ✅ 文化 CRUD
   - ✅ 商品 CRUD
   - ✅ 订单管理
   - ✅ 购物车管理
   - ✅ 优惠券管理
   - ✅ 文件上传

4. **配置管理**
   - 环境变量配置
   - 数据库连接
   - JWT 配置
   - CORS 跨域配置
   - 文件上传配置

5. **文档**
   - 项目 README
   - API 对接指南
   - 数据库表结构说明
   - 部署指南
   - 开发计划

### 🔜 待完成

1. **收藏功能**
   - 需要创建收藏表
   - 实现 CRUD 接口

2. **支付接口**
   - 微信支付集成
   - 支付回调处理

3. **文件存储**
   - 阿里云 OSS / 腾讯云 COS 集成
   - 图片压缩和裁剪

4. **管理前端**
   - Vue 3 + Element Plus
   - 登录页
   - 景点管理
   - 美食管理
   - 文化管理
   - 商品管理
   - 订单管理
   - 数据统计

5. **性能优化**
   - Redis 缓存
   - 接口频率限制
   - 数据库索引优化

6. **安全增强**
   - SQL 注入防护
   - XSS 防护
   - CSRF 防护
   - 接口签名验证

## 快速开始

### 方式一：直接运行（推荐）

```bash
cd backend

# 1. 复制配置文件
cp .env.example .env

# 2. 编辑 .env 文件，修改数据库密码等

# 3. 运行服务
go run main.go
```

### 方式二：使用启动脚本

```bash
cd backend
chmod +x start.sh
./start.sh
```

### 初始化管理员账号

```bash
# 启动服务后访问
curl http://localhost:8080/init-admin

# 默认账号
用户名：admin
密码：admin123
```

## API 接口汇总

### 公共接口（无需认证）
- `POST /api/v1/auth/login` - 小程序登录
- `POST /api/v1/auth/admin/login` - 管理员登录
- `GET /api/v1/attractions` - 景点列表
- `GET /api/v1/attractions/:id` - 景点详情
- `GET /api/v1/food` - 美食列表
- `GET /api/v1/food/:id` - 美食详情
- `GET /api/v1/culture` - 文化列表
- `GET /api/v1/culture/:id` - 文化详情
- `GET /api/v1/market` - 商品列表
- `GET /api/v1/market/:id` - 商品详情

### 用户接口（需要 JWT 认证）
- `GET /api/v1/user/profile` - 获取用户信息
- `PUT /api/v1/user/profile` - 更新用户信息
- `GET /api/v1/user/favorites` - 获取收藏列表
- `POST /api/v1/user/favorites` - 添加收藏
- `DELETE /api/v1/user/favorites/:id` - 删除收藏
- `GET /api/v1/user/cart` - 获取购物车
- `POST /api/v1/user/cart` - 添加到购物车
- `PUT /api/v1/user/cart/:id` - 更新购物车
- `DELETE /api/v1/user/cart/:id` - 从购物车删除
- `GET /api/v1/user/orders` - 获取订单列表
- `POST /api/v1/user/orders` - 创建订单
- `GET /api/v1/user/orders/:id` - 获取订单详情
- `GET /api/v1/user/coupons` - 获取优惠券列表

### 管理员接口（需要管理员 JWT）
- `GET /api/v1/admin/attractions` - 景点列表（管理员）
- `POST /api/v1/admin/attractions` - 创建景点
- `PUT /api/v1/admin/attractions/:id` - 更新景点
- `DELETE /api/v1/admin/attractions/:id` - 删除景点
- `GET /api/v1/admin/food` - 美食列表（管理员）
- `POST /api/v1/admin/food` - 创建美食
- `PUT /api/v1/admin/food/:id` - 更新美食
- `DELETE /api/v1/admin/food/:id` - 删除美食
- `GET /api/v1/admin/culture` - 文化列表（管理员）
- `POST /api/v1/admin/culture` - 创建文化
- `PUT /api/v1/admin/culture/:id` - 更新文化
- `DELETE /api/v1/admin/culture/:id` - 删除文化
- `GET /api/v1/admin/products` - 商品列表（管理员）
- `POST /api/v1/admin/products` - 创建商品
- `PUT /api/v1/admin/products/:id` - 更新商品
- `DELETE /api/v1/admin/products/:id` - 删除商品
- `GET /api/v1/admin/orders` - 订单列表（管理员）
- `PUT /api/v1/admin/orders/:id/status` - 更新订单状态
- `GET /api/v1/admin/coupons` - 优惠券列表（管理员）
- `POST /api/v1/admin/coupons` - 创建优惠券
- `PUT /api/v1/admin/coupons/:id` - 更新优惠券
- `DELETE /api/v1/admin/coupons/:id` - 删除优惠券
- `POST /api/v1/admin/upload` - 文件上传

## 项目特点

### 1. 架构清晰
- 模块化设计，易于维护
- 统一的响应格式
- 完善的错误处理

### 2. 安全可靠
- JWT 认证机制
- 密码加密存储
- CORS 跨域支持
- SQL 注入防护

### 3. 性能优化
- GORM 批量操作
- 数据库索引优化
- 分页查询支持

### 4. 易于扩展
- RESTful API 设计
- 统一的中间件
- 模块化代码组织

## 开发工具推荐

### IDE
- GoLand（推荐）
- VS Code + Go 插件
- Visual Studio

### 数据库工具
- Navicat
- DBeaver
- MySQL Workbench

### API 测试工具
- Postman
- Apifox
- Insomnia

## 常见问题

### 1. 连接数据库失败
```
Error: failed to connect database
```
**解决方案**：
- 检查 MySQL 服务是否启动
- 检查 `.env` 文件中的数据库配置
- 确认数据库用户名和密码正确

### 2. JWT token 过期
```
Error: invalid token
```
**解决方案**：
- 重新登录获取新 token
- 调整 JWT 过期时间

### 3. 文件上传失败
```
Error: failed to save file
```
**解决方案**：
- 检查 `static/uploads` 目录是否存在
- 检查文件大小是否超过限制
- 检查磁盘空间

## 技术支持

如有问题，请查看：
1. `README.md` - 项目说明
2. `API对接指南.md` - 小程序对接文档
3. 控制台日志输出

## 下一步

1. **数据库初始化**
   ```sql
   CREATE DATABASE ninxia_wenlv CHARACTER SET utf8mb4;
   ```

2. **运行服务**
   ```bash
   go run main.go
   ```

3. **测试接口**
   - 使用 Postman 测试 API
   - 使用小程序对接指南测试小程序调用

4. **开发管理前端**
   - 选择前端框架（Vue 3 推荐）
   - 实现登录页和管理界面

5. **对接小程序**
   - 修改小程序 API 地址
   - 实现登录和业务逻辑

## 联系方式

- 项目负责人：Zack
- 技术支持：待添加
