<!-- pages/search/index.wxml -->
<custom-nav title="æœç´¢" back="{{true}}" background="#fff" color="#000" />

<view class="container" style="padding-top: {{navHeight}}px">
  
  <!-- æœç´¢æ  -->
  <view class="search-header">
    <view class="search-input-box">
      <text class="search-icon">ğŸ”</text>
      <input class="search-input" 
             placeholder="{{placeholder}}" 
             value="{{keyword}}" 
             bindinput="onInput"
             bindconfirm="onSearch"
             focus="{{true}}"
             confirm-type="search"/>
      <view class="clear-icon" bindtap="clearKeyword" wx:if="{{keyword}}">âœ•</view>
    </view>
    <view class="search-btn" bindtap="onSearch">æœç´¢</view>
  </view>

  <!-- åˆ†ç±»Tabs -->
  <view class="search-tabs">
    <view class="tab-item {{currentTab === 'attractions' ? 'active' : ''}}" bindtap="switchTab" data-type="attractions">
      æ™¯åŒº
    </view>
    <view class="tab-item {{currentTab === 'products' ? 'active' : ''}}" bindtap="switchTab" data-type="products">
      å•†å“
    </view>
  </view>

  <!-- æœç´¢ç»“æœ -->
  <scroll-view class="result-scroll" scroll-y bindscrolltolower="onLoadMore">
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!list.length && !loading && searched}}">
      <text class="empty-icon">ğŸƒ</text>
      <text class="empty-text">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å†…å®¹</text>
    </view>

    <!-- æ™¯åŒºåˆ—è¡¨ -->
    <block wx:if="{{currentTab === 'attractions'}}">
      <view class="result-list">
        <view class="result-card" wx:for="{{list}}" wx:key="id" bindtap="goToDetail" data-id="{{item.id}}" data-type="attraction">
          <image class="card-img" src="{{item.cover_image || item.images[0]}}" mode="aspectFill" />
          <view class="card-content">
            <text class="card-title">{{item.name}}</text>
            <view class="card-tags" wx:if="{{item.grade || item.category}}">
              <text class="tag" wx:if="{{item.grade}}">{{item.grade}}</text>
              <text class="tag">{{item.category}}</text>
            </view>
            <text class="card-address">{{item.region}} {{item.address}}</text>
          </view>
        </view>
      </view>
    </block>

    <!-- å•†å“åˆ—è¡¨ -->
    <block wx:if="{{currentTab === 'products'}}">
      <view class="result-list">
        <view class="result-card product" wx:for="{{list}}" wx:key="id" bindtap="goToDetail" data-id="{{item.id}}" data-type="product">
          <image class="card-img" src="{{item.cover_image || item.images[0]}}" mode="aspectFill" />
          <view class="card-content">
            <text class="card-title">{{item.name}}</text>
            <view class="card-tags" wx:if="{{item.category}}">
              <text class="tag">{{item.category}}</text>
            </view>
            <view class="price-row">
              <text class="price-symbol">Â¥</text>
              <text class="price-num">{{item.price}}</text>
              <text class="sales-num">å·²å”® {{item.sales}}</text>
            </view>
          </view>
        </view>
      </view>
    </block>

    <!-- åŠ è½½ä¸­ -->
    <view class="loading-more" wx:if="{{loading}}">æ­£åœ¨åŠ è½½...</view>
    <view class="no-more" wx:if="{{!hasMore && list.length > 0}}">æ²¡æœ‰æ›´å¤šäº†</view>
  </scroll-view>
</view>
