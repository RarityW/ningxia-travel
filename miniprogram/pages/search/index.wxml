<!-- pages/search/index.wxml -->
<custom-nav title="æœç´¢" back="{{true}}" background="#fff" color="#000" />

<view class="container" style="padding-top: {{navHeight}}px">
  
  <!-- æœç´¢æ  -->
  <view class="search-header">
    <view class="search-input-box">
      <text class="search-icon">ğŸ”</text>
      <input class="search-input" 
             placeholder="{{placeholder}}" 
             value="{{keyword}}" 
             bindinput="onInput"
             bindconfirm="onSearch"
             focus="{{true}}"
             confirm-type="search"/>
      <view class="clear-icon" bindtap="clearKeyword" wx:if="{{keyword}}">Ã—</view>
    </view>
    <view class="search-btn" bindtap="onSearch">æœç´¢</view>
  </view>

  <!-- åˆ†ç±»Tabs -->
  <view class="search-tabs">
    <view class="tab-item {{currentTab === 'all' ? 'active' : ''}}" bindtap="switchTab" data-type="all">
      ç»¼åˆ
    </view>
    <view class="tab-item {{currentTab === 'attractions' ? 'active' : ''}}" bindtap="switchTab" data-type="attractions">
      æ™¯ç‚¹
    </view>
    <view class="tab-item {{currentTab === 'products' ? 'active' : ''}}" bindtap="switchTab" data-type="products">
      å•†å“
    </view>
  </view>

  <!-- æœç´¢ç»“æœ -->
  <scroll-view class="result-scroll" scroll-y bindscrolltolower="onLoadMore">
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{(!list.length && !allData.attractions.length && !allData.products.length && currentTab !== 'all') && !loading && searched}}">
      <text class="empty-icon">ğŸƒ</text>
      <text class="empty-text">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å†…å®¹</text>
    </view>
    <!-- ç»¼åˆé¡µç©ºçŠ¶æ€ -->
     <view class="empty-state" wx:if="{{currentTab === 'all' && !allData.attractions.length && !allData.products.length && !allData.food.length && !allData.culture.length && !loading && searched}}">
      <text class="empty-icon">ğŸƒ</text>
      <text class="empty-text">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å†…å®¹</text>
    </view>


    <!-- ç»¼åˆåˆ—è¡¨ (å…¨éƒ¨) -->
    <block wx:if="{{currentTab === 'all'}}">
      <!-- æ™¯ç‚¹ -->
      <view class="section-group" wx:if="{{allData.attractions.length}}">
        <view class="group-header">
          <text class="group-title">ç›¸å…³æ™¯ç‚¹</text>
          <view class="more-link" bindtap="switchTab" data-type="attractions">æŸ¥çœ‹æ›´å¤š ></view>
        </view>
        <view class="result-list">
          <view class="result-card" wx:for="{{allData.attractions}}" wx:key="id" bindtap="goToDetail" data-id="{{item.id}}" data-type="attraction">
            <image class="card-img" src="{{item.cover_image || item.images[0]}}" mode="aspectFill" />
            <view class="card-content">
              <text class="card-title">{{item.name}}</text>
              <view class="card-tags" wx:if="{{item.grade || item.category}}">
                <text class="tag" wx:if="{{item.grade}}">{{item.grade}}</text>
                <text class="tag">{{item.category}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- å•†å“ -->
      <view class="section-group" wx:if="{{allData.products.length}}">
        <view class="group-header">
          <text class="group-title">ç›¸å…³å•†å“</text>
          <view class="more-link" bindtap="switchTab" data-type="products">æŸ¥çœ‹æ›´å¤š ></view>
        </view>
        <view class="result-list">
          <view class="result-card product" wx:for="{{allData.products}}" wx:key="id" bindtap="goToDetail" data-id="{{item.id}}" data-type="product">
            <image class="card-img" src="{{item.cover_image || item.images[0]}}" mode="aspectFill" />
            <view class="card-content">
              <text class="card-title">{{item.name}}</text>
              <view class="price-row">
                <text class="price-symbol">Â¥</text>
                <text class="price-num">{{item.price}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- ç¾é£Ÿ (å¯é€‰å±•ç¤º) -->
       <view class="section-group" wx:if="{{allData.food.length}}">
        <view class="group-header">
          <text class="group-title">ç›¸å…³ç¾é£Ÿ</text>
        </view>
         <view class="result-list">
          <view class="result-card" wx:for="{{allData.food}}" wx:key="id" bindtap="goToDetail" data-id="{{item.id}}" data-type="food">
             <image class="card-img" src="{{item.cover_image || item.images[0]}}" mode="aspectFill" />
             <view class="card-content">
              <text class="card-title">{{item.name}}</text>
             </view>
          </view>
         </view>
       </view>
       
    </block>

    <!-- æ™¯ç‚¹åˆ—è¡¨ (å•Tab) -->
    <block wx:if="{{currentTab === 'attractions'}}">
      <view class="result-list">
        <view class="result-card" wx:for="{{list}}" wx:key="id" bindtap="goToDetail" data-id="{{item.id}}" data-type="attraction">
          <image class="card-img" src="{{item.cover_image || item.images[0]}}" mode="aspectFill" />
          <view class="card-content">
            <text class="card-title">{{item.name}}</text>
            <view class="card-tags" wx:if="{{item.grade || item.category}}">
              <text class="tag" wx:if="{{item.grade}}">{{item.grade}}</text>
              <text class="tag">{{item.category}}</text>
            </view>
            <text class="card-address">{{item.region}} {{item.address}}</text>
          </view>
        </view>
      </view>
    </block>

    <!-- å•†å“åˆ—è¡¨ (å•Tab) -->
    <block wx:if="{{currentTab === 'products'}}">
      <view class="result-list">
        <view class="result-card product" wx:for="{{list}}" wx:key="id" bindtap="goToDetail" data-id="{{item.id}}" data-type="product">
          <image class="card-img" src="{{item.cover_image || item.images[0]}}" mode="aspectFill" />
          <view class="card-content">
            <text class="card-title">{{item.name}}</text>
            <view class="card-tags" wx:if="{{item.category}}">
              <text class="tag">{{item.category}}</text>
            </view>
            <view class="price-row">
              <text class="price-symbol">Â¥</text>
              <text class="price-num">{{item.price}}</text>
              <text class="sales-num">å·²å”® {{item.sales}}</text>
            </view>
          </view>
        </view>
      </view>
    </block>

    <!-- åŠ è½½ä¸­ -->
    <view class="loading-more" wx:if="{{loading}}">æ­£åœ¨åŠ è½½...</view>
    <view class="no-more" wx:if="{{!hasMore && list.length > 0}}">æ²¡æœ‰æ›´å¤šäº†</view>
    <!-- ç»¼åˆé¡µæ²¡æœ‰æ›´å¤šä¸ç”¨æ˜¾ç¤ºï¼Œæˆ–è€…æ˜¾ç¤ºâ€œåˆ°åº•äº†â€ -->
    <view class="no-more" wx:if="{{currentTab === 'all' && searched && !loading && (allData.attractions.length || allData.products.length)}}">â€”â€” ä»¥ä¸Šä¸ºç²¾é€‰ç»“æœ â€”â€”</view>
  </scroll-view>
</view>
