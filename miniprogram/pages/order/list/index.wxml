<custom-nav title="我的订单" back="{{true}}" background="#FDF8F3"></custom-nav>

<view class="container" style="padding-top: {{statusBarHeight}}px">
  <block wx:if="{{loading}}">
    <view class="loading-state">
      <text>加载中...</text>
    </view>
  </block>

  <block wx:elif="{{orders.length === 0}}">
    <view class="empty-state">
      <image class="empty-icon" src="/images/tabbar/coupon.png" mode="aspectFit" style="width: 120rpx; height: 120rpx; opacity: 0.5;" />
      <text class="empty-text">您还没有相关订单</text>
    </view>
  </block>

  <block wx:else>
    <view class="order-list">
      <block wx:for="{{orders}}" wx:key="id">
        <view class="order-card">
          <view class="order-header">
            <text class="order-no">订单号: {{item.order_no}}</text>
            <text class="order-status status-{{item.status}}">{{item.status === 0 ? '待支付' : (item.status === 1 ? '已支付' : (item.status === 2 ? '已发货' : (item.status === 3 ? '已完成' : '已取消')))}}</text>
          </view>
          
          <view class="order-items">
            <block wx:for="{{item.items}}" wx:for-item="pItem" wx:key="id">
              <view class="product-item">
                <image class="product-img" src="{{pItem.product.cover_image || '/images/placeholder.jpg'}}" mode="aspectFill" />
                <view class="product-info">
                  <text class="product-name">{{pItem.product.name}}</text>
                  <view class="product-meta">
                    <text class="product-price">¥{{pItem.price}}</text>
                    <text class="product-qty">x{{pItem.quantity}}</text>
                  </view>
                </view>
              </view>
            </block>
          </view>

          <view class="order-footer">
            <text class="total-price">合计: ¥{{item.total_price}}</text>
            <view class="action-btn" wx:if="{{item.status === 0}}" bindtap="payOrder" data-id="{{item.id}}">立即支付</view>
            <view class="action-btn outline" wx:if="{{item.status === 2}}">确认收货</view>
          </view>
        </view>
      </block>
    </view>
  </block>
</view>
